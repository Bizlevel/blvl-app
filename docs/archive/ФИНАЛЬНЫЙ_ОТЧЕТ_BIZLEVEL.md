# Технический аудит и план развития проекта "BizLevel"

**Дата:** 25.07.2024
**Аудитор:** AI Senior Developer

## 1. Executive Summary

Проведен полный технический аудит Flutter-приложения BizLevel. **Общее состояние проекта оценивается как очень хорошее.** Архитектура (Clean Architecture + Riverpod) является современной, масштабируемой и соответствует лучшим практикам. Кодовая база поддерживается в чистоте, а ключевые интеграции с Supabase и Sentry реализованы на высоком профессиональном уровне.

**Ключевые выводы:**
- **Архитектура и код:** Проект имеет прочный технический фундамент для дальнейшего развития.
- **Безопасность:** Интеграция с Supabase, включая политики Row-Level Security, обеспечивает надежную защиту данных.
- **Наблюдаемость:** Интеграция с Sentry позволяет эффективно отслеживать ошибки и производительность.

**Основные риски и рекомендации:**
1.  **Критический пробел в тестовом покрытии:** Отсутствуют тесты для сценариев оплаты и управления подпиской. **Это главный приоритет для устранения.**
2.  **Технический долг по именованию:** Проект необходимо полностью переименовать из `online_course` в `BizLevel` на всех уровнях (код, конфигурации платформ).
3.  **Оптимизация ресурсов:** Проект содержит значительное количество неиспользуемых ассетов, которые следует удалить.

Данный отчет представляет детальный план действий по устранению выявленных проблем и дальнейшему улучшению проекта. Следование этому плану позволит повысить стабильность, безопасность и упростить дальнейшую разработку.

---

## 2. Ключевые метрики проекта

| Метрика                      | Оценка/Статус                                     | Комментарий                                                                 |
| ------------------------------ | ------------------------------------------------- | --------------------------------------------------------------------------- |
| **Архитектура**                | ✅ Отлично                                        | Clean Architecture + Riverpod + GoRouter.                                   |
| **Качество кода**              | ✅ Хорошо                                         | Современные практики, минимум legacy, хороший стайлгайд.                      |
| **Безопасность (RLS)**         | ✅ Отлично                                        | Все ключевые таблицы защищены RLS-политиками.                               |
| **CI/CD**                      | ✅ Хорошо                                         | Настроен базовый CI с тестами и проверкой Sentry.                           |
| **Тестовое покрытие**          | ⚠️ Средне                                        | Хорошее покрытие интеграционными тестами, но есть критические пробелы.      |
| **Управление зависимостями**   | ✅ Хорошо                                         | Стек технологий актуален.                                                   |
| **UI/UX**                      | ✅ Хорошо                                         | Реализован адаптивный дизайн для Web и Mobile.                              |
| **Наличие тех. долга**         | ⚠️ Средне                                        | Переименование проекта, неиспользуемые ассеты, пробелы в тестах.            |

---

## 3. Топ-5 приоритетных задач

Задачи отсортированы по критичности и влиянию на проект.

| Priority | Задача                                           | Описание                                                                                                   | Рекомендация                                                              |
| :------: | ------------------------------------------------ | ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| **1. CRITICAL** | **Отсутствие тестов для флоу оплаты**        | Наиболее рискованная часть приложения (монетизация) не покрыта никакими тестами.                           | Написать интеграционные и юнит-тесты для `PaymentService` и UI оплаты.     |
| **2. HIGH**     | **Полное переименование проекта**        | Текущее название `online_course` присутствует в коде и конфигурациях, что создает путаницу и риски при сборке. | Выполнить переименование по плану из отчета "РЕФАКТОРИНГ_ПЛАН.md".        |
| **3. MEDIUM**   | **Удаление неиспользуемых ассетов**      | ~15+ неиспользуемых SVG-иконок в `assets/` увеличивают размер приложения и загрязняют проект.                 | Удалить все неиспользуемые файлы из `assets/icons/`.                       |
| **4. MEDIUM**   | **Расширение тестового покрытия**        | Репозитории `LevelsRepository` и `LessonsRepository` не имеют юнит-тестов, проверяющих логику кеширования.    | Добавить юнит-тесты для всех репозиториев.                                |
| **5. LOW**      | **Оптимизация конфигурации Sentry**      | `tracesSampleRate=1.0` в продакшене является избыточным и может привести к перерасходу квоты.              | Снизить `tracesSampleRate` до `0.3` для production-сборок.                 |

---

## 4. Детальный план миграции и рефакторинга

Этот план объединяет все необходимые действия для приведения проекта в идеальное состояние.

### **Этап 1: Очистка и подготовка (1-2 часа)**
1.  **Задача:** Создать новую ветку в Git (`refactor/bizlevel-audit-fixes`).
2.  **Задача:** Удалить все неиспользуемые ассеты из `assets/icons/` и `assets/icons/categories/`, как указано в отчете "КОД_АНАЛИЗ.md".
3.  **Проверка:** Убедиться, что проект собирается без ошибок.

### **Этап 2: Улучшение тестового покрытия (4-6 часов)**
1.  **Задача:** Написать интеграционный тест `test/payment_flow_test.dart`, покрывающий весь сценарий оплаты с использованием моков.
2.  **Задача:** Написать юнит-тесты для `LevelsRepository` и `LessonsRepository`, проверяя логику работы с кешем Hive.
3.  **Проверка:** `flutter test` проходит без ошибок.

### **Этап 3: Переименование проекта (3-5 часов)**
1.  **Задача:** Переименовать пакет в `pubspec.yaml` и обновить все Dart-импорты (`package:online_course` -> `package:bizlevel`).
2.  **Задача:** Переименовать `applicationId` и `namespace` для Android, включая обновление структуры папок для `MainActivity.kt`.
3.  **Задача:** Обновить `CFBundleName` и другие идентификаторы для iOS.
4.  **Проверка:** Выполнить `flutter clean`, затем собрать и запустить приложение на iOS и Android. Проверить, что все работает как ожидалось.

### **Этап 4: Финальные улучшения (1-2 часа)**
1.  **Задача:** Снизить `tracesSampleRate` в `main.dart` до `0.3` для `prod`-сборки.
2.  **Задача:** Проверить и настроить `secrets` для CI/CD в GitHub Actions.
3.  **Задача:** Просмотреть и обновить всю документацию в папке `docs/`, чтобы она отражала новое название и структуру.
4.  **Слияние ветки** в основную ветку разработки.

---

## 5. Оценка трудозатрат

| Этап                         | Оценка времени (часы) |
| ---------------------------- | --------------------- |
| 1. Очистка и подготовка      | 1 - 2                 |
| 2. Улучшение тестов          | 4 - 6                 |
| 3. Переименование проекта    | 3 - 5                 |
| 4. Финальные улучшения       | 1 - 2                 |
| **ИТОГО:**                   | **9 - 15 часов**      |

*Оценка является приблизительной и может меняться в зависимости от сложности отладки нативных сборок после переименования.*

## 6. Quick Wins (Быстрые победы)

Действия, которые можно выполнить очень быстро и которые принесут немедленную пользу.

- **Удаление неиспользуемых ассетов:** Можно сделать за 15 минут. Сразу уменьшит размер приложения и очистит проект.
- **Оптимизация Sentry:** Изменение `tracesSampleRate` займет 5 минут, но может сэкономить значительные средства на квоте Sentry.
- **Обновление документации:** Добавление `README.md` в `lib/` с кратким описанием архитектуры поможет новым разработчикам быстрее войти в курс дела. 