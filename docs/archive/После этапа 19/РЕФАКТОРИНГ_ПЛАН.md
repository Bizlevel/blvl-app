# План рефакторинга и переименования проекта в "BizLevel"

Этот документ описывает пошаговый план по комплексному рефакторингу и переименованию проекта `online_course` в `BizLevel`. План основан на результатах технического аудита.

## 1. Список мест для переименования

### Код и конфигурация Flutter
- **`pubspec.yaml`**:
    - `name: online_course` -> `name: bizlevel`
- **Все Dart-файлы в `lib/` и `test/`**:
    - Все импорты вида `package:online_course/...` должны быть заменены на `package:bizlevel/...`. Это можно сделать автоматически с помощью функции "Найти и заменить во всех файлах" в IDE.
- **`ios/Runner/Info.plist`**:
    - `CFBundleName`: `online_course` -> `BizLevel`

### Конфигурация Android
- **`android/app/build.gradle`**:
    - `namespace`: `com.sangvaleap.online_course` -> `kz.bizlevel.app`
    - `applicationId`: `com.sangvaleap.online_course` -> `kz.bizlevel.app`
- **Все файлы `AndroidManifest.xml`** (`main`, `debug`, `profile`):
    - `package`: `com.sangvaleap.online_course` -> `kz.bizlevel.app` (может обновиться автоматически после изменения `build.gradle`).
    - `android:label`: `online_course` -> `BizLevel`
- **`android/app/src/main/kotlin/com/sangvaleap/online_course/MainActivity.kt`**:
    - Необходимо изменить структуру директорий на `.../kotlin/kz/bizlevel/app/`
    - `package`: `com.sangvaleap.online_course` -> `kz.bizlevel.app`
- **`android/app/proguard-rules.pro`**:
    - `-keep class com.sangvaleap.online_course.** { *; }` -> `-keep class kz.bizlevel.app.** { *; }`

### Документация и прочее
- **`README.md`**: Удалить упоминания `sangvaleap`.
- **`lib/utils/data.dart`**: Удалить или изменить тестовые данные, содержащие `sangvaleap`.

## 2. Пошаговый план рефакторинга

План разделен на этапы для минимизации рисков. После каждого этапа рекомендуется выполнять полную проверку проекта (сборка, запуск тестов).

---

### **Этап 1: Подготовка и очистка (низкий риск)**
*   **Действия**:
    1.  Создать новую ветку в Git для рефакторинга (например, `refactor/rename-to-bizlevel`).
    2.  **Удалить неиспользуемые ассеты**, перечисленные в отчете "КОД_АНАЛИЗ.md".
    3.  Удалить файл `lib/utils/data.dart`, так как он содержит только тестовые данные и не используется в приложении.
    4.  Запустить `flutter pub get`.
*   **Проверка**: Убедиться, что проект собирается и все существующие тесты проходят.

---

### **Этап 2: Переименование пакета Flutter (средний риск)**
*   **Действия**:
    1.  В `pubspec.yaml` изменить `name: online_course` на `name: bizlevel`.
    2.  Выполнить команду `flutter pub get`.
    3.  С помощью IDE (VS Code, Android Studio) выполнить глобальный поиск и замену `package:online_course/` на `package:bizlevel/` во всех файлах проекта.
*   **Проверка**:
    - Проект должен успешно анализироваться (`flutter analyze`).
    - Все тесты должны проходить (`flutter test`).
    - Приложение должно корректно собираться и запускаться на эмуляторах iOS и Android.

---

### **Этап 3: Переименование на платформах (высокий риск)**
*   **Действия**:
    1.  **Android**:
        - В `android/app/build.gradle` изменить `namespace` и `applicationId`.
        - Переместить `MainActivity.kt` в новую структуру директорий `.../kz/bizlevel/app/` и обновить `package` внутри файла.
        - Обновить `android:label` в `AndroidManifest.xml`.
        - Обновить `proguard-rules.pro`.
    2.  **iOS**:
        - В `ios/Runner/Info.plist` изменить `CFBundleName` на `BizLevel`. (Также может потребоваться изменение `PRODUCT_BUNDLE_IDENTIFIER` в `project.pbxproj`, если он не использует переменную).
*   **Проверка**:
    - Выполнить `flutter clean`.
    - Собрать и запустить приложение на реальных устройствах или эмуляторах для iOS и Android.
    - Проверить, что `applicationId` и `bundleId` корректно обновились.
    - Убедиться, что ProGuard не удаляет нужные классы в release-сборке.

---

### **Этап 4: Улучшение тестового покрытия (низкий риск)**
*   **Действия**:
    1.  **Написать интеграционные тесты для флоу оплаты**:
        - Создать `test/payment_flow_test.dart`.
        - Покрыть сценарии: переход на экран Premium, успешное "создание" сессии, обработка ошибок. Использовать моки для `PaymentService` и Edge Function.
    2.  **Написать юнит-тесты для репозиториев**:
        - Создать тесты для `LevelsRepository` и `LessonsRepository`, проверяя логику кеширования в Hive.
*   **Проверка**: Все новые и старые тесты должны проходить.

---

### **Этап 5: Финальные штрихи и CI (низкий риск)**
*   **Действия**:
    1.  Проверить и обновить `README.md` и другую документацию в папке `/docs`.
    2.  Установить `tracesSampleRate` в Sentry на `0.3` для `prod` окружения в `main.dart`, как рекомендовано в отчете "ИНТЕГРАЦИИ_АНАЛИЗ.md".
    3.  Настроить `secrets` в GitHub Actions и убедиться, что CI workflow, добавленный на этапе 13.8, работает корректно.
*   **Проверка**: CI должен успешно проходить все этапы (тесты, проверки Sentry, сборка).

## 3. Оценка рисков
- **Наибольший риск**: Этап 3 (Переименование на платформах). Неправильное изменение `applicationId` или структуры нативных файлов может полностью сломать сборку. Требует внимательности и тщательной проверки.
- **Снижение рисков**:
    - Выполнять рефакторинг в отдельной ветке.
    - Делать коммиты после каждого успешного под-этапа.
    - Регулярно запускать полный набор тестов.

Этот план обеспечивает структурированный и последовательный подход к рефакторингу, минимизируя риски и гарантируя, что все аспекты проекта будут обновлены. 