# Отчёт об ошибках Sentry (последние 3 дня)

Дата формирования: 27.07.2025

## Сводка

- Найдено **3** уникальных issues
- Всего зафиксировано **26** событий
- Уникальных пользователей: **3**
- Категории ошибок:
  1. **Аутентификация / База данных** — 2 issues
  2. **Storage / Медиа** — 1 issue

---

## Детали по категориям

### 1. Аутентификация / База данных

Проблема: нарушение ограничения `NOT NULL` для колонки `email` в таблице `users`.

| Issue ID | Сообщение | Событий | Пользователей | Первый раз | Последний раз |
|----------|-----------|---------|---------------|------------|---------------|
| [BIZLEVEL-FLUTTER-10](https://bizlevel.de.sentry.io/issues/BIZLEVEL-FLUTTER-10) | `AuthFailure: null value in column "email" ...` | 3 | 1 | 27.07 09:11 | 27.07 09:14 |
| [BIZLEVEL-FLUTTER-Z](https://bizlevel.de.sentry.io/issues/BIZLEVEL-FLUTTER-Z) | `PostgrestException: null value in column "email" ...` | 8 | 2 | 27.07 08:21 | 27.07 09:14 |

Анализ:
- Ошибка возникает при обновлении профиля (`AuthService.updateProfile`) без обязательного поля `email`.
- Стектрейсы указывают на использование `auth_service.dart` и экран `/profile`.
- Последнее появление — менее часа назад, проблема актуальна.

Последствия: невозможность сохранить профиль → пользователь застревает на онбординге/профиле.

---

### 2. Storage / Медиа

Проблема: отсутствует запрашиваемый объект в Supabase Storage (HTTP 404).

| Issue ID | Сообщение | Событий | Пользователей | Первый раз | Последний раз |
|----------|-----------|---------|---------------|------------|---------------|
| [BIZLEVEL-FLUTTER-F](https://bizlevel.de.sentry.io/issues/BIZLEVEL-FLUTTER-F) | `StorageException: Object not found (404)` | 15 | 2 | 16.07 | 24.07 |

Анализ:
- Ошибка прилетает при попытке получить видео/обложку на экране `/home` (LevelsMapScreen).
- Судя по `status.md`, была реализована обработка 404 без выброса исключения; события прекратились 2 дня назад.

Последствия: отсутствие медиа-файла снижает UX, но не блокирует использование приложения.

---

## Предварительные рекомендации (для следующего спринта)

1. **Аутентификация / БД**
   - Провести ревизию `AuthService.updateProfile` и всех вызовов, гарантировать передачу `email`.
   - Добавить клиентскую валидацию перед отправкой, чтобы избежать пустого `email`.
   - Логику повторного сохранения профиля протестировать unit-тестами.

2. **Storage / Медиа**
   - Синхронизировать список файлов в bucket `video` и `level-covers` с данными в БД.
   - Добавить ленивую проверку существования файла перед попыткой воспроизведения/загрузки.
   - Убедиться, что подавление ошибки не скрывает реальные проблемы: оставить `Sentry.captureException` для 404, но помечать как `level: warning`.

> ⚠️ На данном этапе изменений в коде **не вносилось** — отчёт предназначен для планирования работ по устранению ошибок.
