# –ú–∏–≥—Ä–∞—Ü–∏—è RAG —Å–∏—Å—Ç–µ–º—ã –Ω–∞ JSON-–æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
–ó–∞–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–π RAG —Å–∏—Å—Ç–µ–º—ã, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `documents` –≤ Supabase, –Ω–∞ –Ω–æ–≤—É—é JSON-–æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–∏—Å–∫–æ–º (dense + BM25) –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ –∏ —Å–Ω–∏–∂–µ–Ω–∏—è –∑–∞—Ç—Ä–∞—Ç.

## üìä –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### 1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã
- **–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ–∫—É—â–∞—è RAG —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É `documents` —Å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ `level_id`, –∞ –Ω–µ –∫ `lesson_id`
- **–ö–æ–Ω—Ç–µ–Ω—Ç**: –ù–∞–π–¥–µ–Ω –≤ –ø–æ–ª–µ `quiz_questions` —Ç–∞–±–ª–∏—Ü—ã `lessons` (40 —É—Ä–æ–∫–æ–≤, —É—Ä–æ–≤–Ω–∏ 11-20)

### 2. –°–æ–∑–¥–∞–Ω–∏–µ JSON-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö**: 40 —É—Ä–æ–∫–æ–≤ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∏–∑ `quiz_questions`
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∞ –∏–µ—Ä–∞—Ä—Ö–∏—è `levels/{level_id}/lesson_{lesson_id}/`
- **–ê—Ç–æ–º–∏–∑–∞—Ü–∏—è**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 200 —Ñ–∞–∫—Ç–æ–≤ (–ø–æ 5 –Ω–∞ —É—Ä–æ–∫) —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- **–§–æ—Ä–º–∞—Ç**: `lesson.json`, `facts.jsonl`, `README.md` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **–°–∫—Ä–∏–ø—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏**: `process_lessons.py`, `generate_facts.py`
- **–ú–∏–≥—Ä–∞—Ü–∏—è**: `migrate_to_supabase.py` –¥–ª—è –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: `index_to_pgvector.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å pgvector
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üöÄ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 1. –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫**: –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã pgvector –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è dense (OpenAI) + BM25 –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `level_number` –∏ `section`

### 2. –ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: –ß–µ—Ç–∫–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É —É—Ä–æ–∫–∞–º–∏ –∏ —Ñ–∞–∫—Ç–∞–º–∏
- **–ë–æ–≥–∞—Ç—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ**: –¢–µ–≥–∏, —Ç–µ–º—ã, –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º**: –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞

### 3. –°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç
- **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: JSON —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: Git-–∫–æ–Ω—Ç—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —É—Ä–æ–∫–æ–≤

## üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (5 –º–∏–Ω—É—Ç)
**–§–∞–π–ª—ã**: `env_example.txt`, `.env`
```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env_example.txt .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å SUPABASE_URL, SUPABASE_ANON_KEY, OPENAI_API_KEY
```

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (2 –º–∏–Ω—É—Ç—ã)
**–°–∫—Ä–∏–ø—Ç**: `migrate_to_supabase.py` (—Ñ—É–Ω–∫—Ü–∏—è `create_tables()`)
```bash
python migrate_to_supabase.py --create-tables-only
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–∞–±–ª–∏—Ü—ã `lesson_facts`, `lesson_metadata` —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

### –≠—Ç–∞–ø 3: –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (1 –º–∏–Ω—É—Ç–∞)
**–°–∫—Ä–∏–ø—Ç**: `migrate_to_supabase.py` (—Ñ—É–Ω–∫—Ü–∏—è `load_lesson_metadata()`)
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 40 –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ `lesson_metadata`

### –≠—Ç–∞–ø 4: –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ñ–∞–∫—Ç–æ–≤ (15-20 –º–∏–Ω—É—Ç)
**–°–∫—Ä–∏–ø—Ç**: `index_to_pgvector.py`
```bash
python index_to_pgvector.py
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 200 —Ñ–∞–∫—Ç–æ–≤ —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `lesson_facts`

### –≠—Ç–∞–ø 5: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –ø–æ–∏—Å–∫–∞ (1 –º–∏–Ω—É—Ç–∞)
**–°–∫—Ä–∏–ø—Ç**: `migrate_to_supabase.py` (—Ñ—É–Ω–∫—Ü–∏—è `create_search_functions()`)
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –§—É–Ω–∫—Ü–∏–∏ `search_lesson_facts()`, `search_by_level()`

### –≠—Ç–∞–ø 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ leo-chat (10 –º–∏–Ω—É—Ç)
**–§–∞–π–ª—ã**: `leo_chat_retriever.py`, `leo_chat_config.py`
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ fallback –Ω–∞ —Å—Ç–∞—Ä—É—é —Å–∏—Å—Ç–µ–º—É
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (5 –º–∏–Ω—É—Ç)
**–°–∫—Ä–∏–ø—Ç—ã**: `test_new_rag.py`, `test_fallback.py`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤

## ‚ö†Ô∏è –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É

### –í–∞–∂–Ω–æ: –ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –±–µ–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –ë–î!
**–ü—Ä–∏—á–∏–Ω–∞**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü Supabase –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã

### –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–∫–∞—Ç–∞:

#### 1. –ú—è–≥–∫–∏–π –æ—Ç–∫–∞—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
**–í—Ä–µ–º—è**: 2 –º–∏–Ω—É—Ç—ã
**–î–µ–π—Å—Ç–≤–∏—è**:
```bash
# 1. –û—Ç–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ—Ç—Ä–∏–≤–µ—Ä –≤ leo-chat
# –í —Ñ–∞–π–ª–µ leo_chat_config.py —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
USE_NEW_RAG = False

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å—Ç–∞—Ä–æ–π RAG —Å–∏—Å—Ç–µ–º—ã
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç–∞—Ä–æ–π RAG, –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –æ—Å—Ç–∞—é—Ç—Å—è

#### 2. –ß–∞—Å—Ç–∏—á–Ω—ã–π –æ—Ç–∫–∞—Ç
**–í—Ä–µ–º—è**: 10 –º–∏–Ω—É—Ç
**–î–µ–π—Å—Ç–≤–∏—è**:
```sql
-- 1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–Ω–µ —É–¥–∞–ª—è—Ç—å!)
ALTER TABLE lesson_facts RENAME TO lesson_facts_backup;
ALTER TABLE lesson_metadata RENAME TO lesson_metadata_backup;

-- 2. –£–¥–∞–ª–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
DROP FUNCTION IF EXISTS search_lesson_facts;
DROP FUNCTION IF EXISTS search_by_level;

-- 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—É—é RAG —Å–∏—Å—Ç–µ–º—É
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

#### 3. –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –æ—Ç–∫–∞—Ç (–µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —Å–ª–æ–º–∞–Ω–∞)
**–í—Ä–µ–º—è**: 30 –º–∏–Ω—É—Ç
**–î–µ–π—Å—Ç–≤–∏—è**:
```bash
# 1. –û—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–¥ leo-chat –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é
git checkout HEAD~1

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
# 4. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ dev-–æ–∫—Ä—É–∂–µ–Ω–∏–∏
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏ RAG —Å–∏—Å—Ç–µ–º—ã
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞
4. **–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç—å backup —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π

## üöÄ –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install aiohttp openai
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `env_example.txt` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:
```bash
cp env_example.txt .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `SUPABASE_URL` - URL –≤–∞—à–µ–≥–æ Supabase –ø—Ä–æ–µ–∫—Ç–∞
- `SUPABASE_ANON_KEY` - –∞–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á Supabase
- `OPENAI_API_KEY` - –∫–ª—é—á OpenAI API

### 3. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
python migrate_to_supabase.py
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ lesson_facts
```sql
CREATE TABLE lesson_facts (
    id TEXT PRIMARY KEY,                    -- fact_02_00_001
    content TEXT NOT NULL,                  -- —Ç–µ–∫—Å—Ç —Ñ–∞–∫—Ç–∞
    lesson_id INTEGER NOT NULL,            -- ID —É—Ä–æ–∫–∞
    level_number INTEGER NOT NULL,         -- –Ω–æ–º–µ—Ä —É—Ä–æ–≤–Ω—è
    section TEXT NOT NULL,                 -- lesson_2
    title TEXT NOT NULL,                   -- –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞
    file_name TEXT NOT NULL,               -- lesson_2.json
    doc_id TEXT NOT NULL,                  -- lesson_2_11
    chunk_index INTEGER NOT NULL,          -- –∏–Ω–¥–µ–∫—Å —á–∞–Ω–∫–∞
    tags TEXT[] DEFAULT '{}',              -- —Ç–µ–≥–∏
    topics TEXT[] DEFAULT '{}',            -- —Ç–µ–º—ã
    keywords TEXT[] DEFAULT '{}',          -- –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    embedding VECTOR(1536),                -- —ç–º–±–µ–¥–¥–∏–Ω–≥ OpenAI
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### –¢–∞–±–ª–∏—Ü–∞ lesson_metadata
```sql
CREATE TABLE lesson_metadata (
    lesson_id INTEGER PRIMARY KEY,         -- ID —É—Ä–æ–∫–∞
    level_id INTEGER NOT NULL,             -- ID —É—Ä–æ–≤–Ω—è
    title TEXT NOT NULL,                   -- –Ω–∞–∑–≤–∞–Ω–∏–µ
    description TEXT NOT NULL,             -- –æ–ø–∏—Å–∞–Ω–∏–µ
    video_url TEXT,                        -- —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ
    duration_minutes INTEGER,              -- –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    language TEXT NOT NULL,                -- —è–∑—ã–∫ (ru)
    version TEXT NOT NULL,                 -- –≤–µ—Ä—Å–∏—è (1.0)
    created_at TIMESTAMP WITH TIME ZONE NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL,
    checksum_sha256 TEXT NOT NULL,         -- –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞
    content JSONB NOT NULL                 -- –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞
);
```

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–∏—Å–∫ –ø–æ —É—Ä–æ–≤–Ω—é
```sql
SELECT * FROM search_by_level(11, '—Ü–µ–ª–∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è', 5);
```

### –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
```sql
SELECT * FROM search_lesson_facts(
    '–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–ª–µ–π',
    '[0.1, 0.2, ...]'::vector,  -- —ç–º–±–µ–¥–¥–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞
    11,                          -- —Ñ–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é
    'lesson_2',                  -- —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å–µ–∫—Ü–∏–∏
    10                           -- –ª–∏–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
);
```

### –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º
```sql
SELECT * FROM lesson_facts 
WHERE tags @> '["option"]' 
AND level_number = 11;
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–≠–º–±–µ–¥–¥–∏–Ω–≥–∏**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å `text-embedding-3-small` (1536 –∏–∑–º–µ—Ä–µ–Ω–∏–π)
2. **–Ø–∑—ã–∫**: –í—Å–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
3. **–ò–Ω–¥–µ–∫—Å—ã**: –°–æ–∑–¥–∞–Ω—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º, —Å–µ–∫—Ü–∏—è–º –∏ –≤–µ–∫—Ç–æ—Ä–∞–º
4. **Fallback**: –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fallback –Ω–∞ —Ç–µ–∫—É—â—É—é RAG

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏ –∫–ª—é—á API
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –∞–∫—Ç–∏–≤–µ–Ω

### –û—à–∏–±–∫–∞ OpenAI API
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á API
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ —Å—á–µ—Ç—É

### –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ pgvector —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–∫—Ç–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º
SELECT level_number, COUNT(*) FROM lesson_facts GROUP BY level_number;

-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–∫–æ–≤
SELECT COUNT(*) FROM lesson_metadata;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
SELECT id, array_length(embedding, 1) as embedding_size 
FROM lesson_facts LIMIT 5;
```
