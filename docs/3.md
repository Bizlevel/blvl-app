### Отличия между нашей веткой и origin/main по скриптам и индексации

- **Новые скрипты (есть в main, отсутствовали у нас)**:
  - `scripts/index_cases.py`: индексация кейсов для RAG (подготовка и загрузка эмбеддингов/метаданных).
  - `scripts/test_rag_search.py`: проверка релевантности поиска по проиндексированным кейсам.
  - `scripts/debug_cases.py`: отладка/диагностика данных кейсов и индексации.
  - `scripts/requirements.txt`: зависимости для скриптов индексации (`openai`, `supabase`, `python-dotenv` и др.).
  - `scripts/README_case_indexing.md`: краткая инструкция по индексации кейсов.

- **Supabase Edge Functions**:
  - `supabase/functions/leo-chat/index.ts` (в main существенно обновлён):
    - Подкручены промпты ботов, интеграция с индексацией кейсов (RAG).
    - Фоновый подсчёт стоимости запросов и запись результатов в таблицу `ai_message`.
    - В коммитах упоминается временный откат/комментирование прежней реализации для отладки.
  - `supabase/functions/leo-memory/index.ts` (в main изменён):
    - Нормализация и дедупликация `memories`, корректировки логики сохранения.
  - `supabase/functions/leo-test/index.ts` (новый):
    - Тестовая функция для проверки интеграций/промптов.

- **Миграции/индексы БД**:
  - В репозитории отличий в `supabase/migrations` между нашей веткой и `origin/main` не обнаружено.
  - В коммитах `main` упоминаются: добавление Database Webhook на создание сообщений в `leo_messages`, правки RLS политик. Эти изменения, вероятно, вносились через панель и не отражены миграциями в репозитории.

- **Документация (main → добавлено/обновлено)**:
  - Добавлены: `docs/cost_tracking_implementation_plan.md`, `docs/plan_case_rag_indexing.md`, `docs/rag_indexing_complete_report.md`.
  - Обновлены: `docs/status.md`, `docs/bizlevel-implementation-plan-phase9.md`.

Примечание: для совместимости приложения с обновлённой серверной логикой мы приняли версию `lib/services/leo_service.dart` из `origin/main`.

